<!DOCTYPE html>
<html lang="en">
<head>
    <title>Email Form</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
    <!-- Boxicons CSS -->
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="static/css/userdash-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

<section class="home">
    <div class="text">
        <h1>User Dashboard</h1>
    </div>
    <div class="text">
        <div class="button-container">
            <button onclick="runSpeechRecog('reciever')">Speech for To</button>
            <button onclick="runSpeechRecog('subject')">Speech for Subject</button>
            <button onclick="runSpeechRecog('message')">Speech for Message</button>
        </div>
        <div class="modal-container">
            <div class="modal-content">
                <form name="emailForm" action="{{ url_for('email') }}" method="post" enctype="multipart/form-data">
                    <div class="form-item">
                        <p class="formLabel" for="reciever">To:</p>
                        <input type="text" name="reciever" id="reciever" class="form-style" required oninput="getSuggestions(this.value)" />
                       <br> <h6 id="suggestions-container"></h6>
                    </div>
                    <div class="form-item">
                        <p class="formLabel" for="subject">Subject:</p>
                        <input type="text" name="subject" id="subject" class="form-style" required />
                    </div>
                    <div class="form-item">
                        <p class="formLabel" for="message">Message:</p>
                        <textarea  name="message" id="message" rows="4" class="form-style" required ></textarea>
                    </div>
                    <div class="form-item">
                        <p class="formLabel" for="image">Upload Image:</p>
                        <input type="file" name="image" id="image" class="form-style" accept="image/*" />
                    </div>
                    <div class="form-item">
                        <button type="submit" class="send">Send</button>
                    </div>
                </form>
            </div>
        </div>
        <h3 id="output" class="hide"></h3>
    </div>
</div>
</section>

<script>
var currentSubject = "";
var currentMessage = "";
var currentReciever = "";

// Function to get autocomplete suggestions
function getSuggestions(prefix) {
    fetch('/autocomplete?prefix=' + prefix)
        .then(response => response.json())
        .then(data => {
            var suggestionsContainer = document.getElementById('suggestions-container');
            suggestionsContainer.innerHTML = ''; // Clear previous suggestions

            // Display suggestions
            data.suggestions.forEach(suggestion => {
                var suggestionElement = document.createElement('div');
                suggestionElement.textContent = suggestion;
                suggestionElement.onclick = function() {
                    document.getElementById('reciever').value = suggestion;
                    suggestionsContainer.innerHTML = ''; // Clear suggestions after selection
                };
                suggestionsContainer.appendChild(suggestionElement);
            });
        });
}

runSpeechRecog = (field) => {
    document.getElementById("output").innerHTML = "Listening...";
    var output = document.getElementById('output');
    var textInput = document.getElementById(field);
    let recognition = new webkitSpeechRecognition();
    recognition.onstart = () => {
        output.innerHTML = "Listening...";
    }
    recognition.onresult = (e) => {
        var transcript = e.results[0][0].transcript;
        output.innerHTML = transcript;

        // Replace specific phrases with symbols
        transcript = transcript.replace(/at the rate/g, '@');
        transcript = transcript.replace(/question mark/g, '?');
        transcript = transcript.replace(/dot/g, '.');
        transcript = transcript.replace(/new line/g, '\n');

        if (field === 'subject') {
            currentSubject = transcript;
            textInput.value = currentSubject;
        } else if (field === 'message') {
            currentMessage = transcript;
            textInput.value = currentMessage;
        }
        else if (field === 'reciever') {
            currentReciever = transcript;
            textInput.value = currentReciever;
        }
    }
    recognition.start();
}
</script>

<!-- Script -->
<script src="{{ url_for('static', filename='userdash-script.js') }}"></script>  

</body>
</html>
